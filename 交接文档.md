# WeChat 群聊分析工具 - 交接文档

## 📋 项目概述

这是一个**微信群聊自动总结工具**，用于分析 QuickCreator 的 AI SEO 学习交流群的聊天记录，自动生成每周讨论精华，并转换为带水印的图片便于分享。

**核心功能**：
- 从 MySQL 数据库读取微信群聊记录
- 使用大语言模型（OpenAI）自动分类和总结讨论内容
- 生成 Markdown 格式的精华总结
- 转换为带 QuickCreator 水印的 PNG 图片

---

## 🗂️ 代码仓库

**GitHub 地址**：https://github.com/kycloudtech/wechat

**本地路径**：`/Users/zhangxiatian/ky_trans/wechat`

**主要文件**：
```
wechat/
├── utils.py          # AI 调用工具（已迁移到环境变量）
├── .env.example      # 环境变量模板
├── .env              # 实际配置文件（需自己创建，不提交到 Git）
├── .gitignore        # Git 忽略配置
└── 交接文档.md       # 本文档
```

---

## ⚙️ 环境配置

### 1. Python 依赖

```bash
pip install openai python-dotenv
```

### 2. 创建配置文件

```bash
# 复制模板
cp .env.example .env

# 编辑 .env 文件，填入实际凭据
vim .env
```

**需要配置的环境变量**：

```bash
# Volces API（字节跳动的 AI 服务）
VOLCES_API_KEY=你的_API_密钥
VOLCES_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
VOLCES_MODEL=ep-20250210182716-gfw9b

# 或者使用 OpenAI
OPENAI_API_KEY=你的_OpenAI_密钥
OPENAI_MODEL=gpt-4
```

⚠️ **重要**：`.env` 文件已被 `.gitignore` 排除，**绝对不要**提交到 Git！

---

## 🚀 使用方法

### 基本用法

```python
from utils import call_model

# 调用 AI 模型
response = call_model(
    user_content="你的问题或需要分析的内容",
    system_content="系统提示词（可选）",
    response_format="text",  # 或 "json_object"
    model=None  # 使用默认模型
)

print(response)
```

### 参数说明

- `user_content`：必填，主要的输入内容
- `system_content`：可选，系统角色提示词
- `response_format`：可选，返回格式（"text" 或 "json_object"）
- `model`：可选，模型名称（默认使用环境变量中的模型）

---

## 📊 数据来源

### MySQL 数据库

- **主机**：`ky-serverless-mysql.cluster-cy5scjl84t4x.us-east-2.rds.amazonaws.com`
- **端口**：3306
- **数据库**：`wechat_messages`
- **表名**：`messages`
- **用户名**：见 `.env` 文件（未在代码中硬编码）

### 主要字段

| 字段 | 说明 |
|------|------|
| `chat_hash` | 群聊唯一标识 |
| `nick` | 发言人昵称 |
| `msg` | 消息内容 |
| `timestamp` | 消息时间戳 |
| `msgtype` | 消息类型（通常筛选"文本"） |

---

## 🔐 安全注意事项

### 1. 凭据管理

✅ **正确做法**：
- 所有密码、API Key 都放在 `.env` 文件中
- `.env` 已被 `.gitignore` 排除，不会提交到 Git
- 使用 `python-dotenv` 加载环境变量

❌ **错误做法**：
- 不要在代码中硬编码任何密码或 API Key
- 不要把 `.env` 文件提交到 Git
- 不要在公开场合分享配置文件

### 2. 数据隐私

- 群聊记录包含用户的真实讨论内容，属于敏感数据
- 生成的总结和图片不要随意分享到公开渠道
- 数据库访问权限仅限授权人员

---

## 🛠️ 常见问题

### Q1: 提示 "No module named 'dotenv'"

**解决方法**：
```bash
pip install python-dotenv
```

### Q2: API 调用失败

**检查清单**：
1. `.env` 文件是否存在？
2. API Key 是否正确？
3. 网络是否能访问 API 服务？
4. API 余额是否充足？

### Q3: 如何切换到 OpenAI？

编辑 `utils.py`，修改初始化代码：
```python
client = OpenAI(
    api_key=os.getenv("OPENAI_API_KEY"),
    # 不设置 base_url，使用默认的 OpenAI 服务
)
default_model = os.getenv("OPENAI_MODEL", "gpt-4")
```

### Q4: 在哪里获取 Volces API Key？

访问：https://console.volcengine.com/ark

---

## 📝 开发规范

### Git 工作流

```bash
# 1. 修改代码
vim utils.py

# 2. 查看修改
git status
git diff

# 3. 提交修改
git add utils.py
git commit -m "feat: 添加新功能"

# 4. 推送到远程
git push origin main
```

### 提交信息格式

```
类型: 简短描述

详细说明（可选）
```

**类型**：
- `feat`: 新功能
- `fix`: 修复 bug
- `refactor`: 重构代码
- `docs`: 文档更新
- `chore`: 杂项（依赖更新等）

---

## 🆘 联系方式

**如有问题，请联系**：
- 交接人：[你的名字]
- 邮箱：[你的邮箱]
- 企业微信：[你的企微]

**参考资源**：
- GitHub 仓库：https://github.com/kycloudtech/wechat
- Python dotenv 文档：https://pypi.org/project/python-dotenv/
- OpenAI API 文档：https://platform.openai.com/docs

---

**文档版本**：v1.0
**创建日期**：2025-11-25
**最后更新**：2025-11-25
